generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model cache_most_visited {
  id        Int      @id @default(autoincrement()) @db.UnsignedInt
  day       DateTime @db.Date
  page      String   @db.Text
  entity_id Int?     @db.UnsignedInt
  visits    Int      @db.UnsignedInt
}

model country {
  id           Int            @id @default(autoincrement()) @db.UnsignedInt
  iso_key      String         @unique @db.VarChar(10)
  name         String         @db.Text
  page_ip_info page_ip_info[]
  player       player[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model elo_1v1_cache {
  id            Int      @id @default(autoincrement()) @db.UnsignedInt
  created       DateTime @db.DateTime(0)
  type          String   @default("match") @db.VarChar(255)
  match_id      Int?     @db.UnsignedInt
  player_id     Int      @db.UnsignedInt
  elo_before    Int      @db.UnsignedInt
  elo_after     Int      @db.UnsignedInt
  match_time    DateTime @db.Date // redundant
  tournament_id Int?     @db.UnsignedInt // redundant

  match      match_1v1?  @relation(fields: [match_id], references: [id])
  player     player?     @relation(fields: [player_id], references: [id])
  tournament tournament? @relation(fields: [tournament_id], references: [id])

  @@index([match_id], map: "match_id")
  @@index([match_time], map: "match_time")
  @@index([player_id], map: "player_id")
  @@index([tournament_id], map: "tournament_id")
}

model extern_de_cache {
  id       Int      @id @default(autoincrement()) @db.UnsignedInt
  steam_id String   @db.VarChar(40)
  time     DateTime @db.DateTime(0)
  rating   Int      @db.UnsignedInt
  rank     Int      @db.UnsignedInt

  player player? @relation(fields: [steam_id], references: [steam_id_failed])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model extern_voobly_cache {
  id        Int      @id @default(autoincrement()) @db.UnsignedInt
  voobly_id Int      @db.UnsignedInt
  ladder    Int      @default(1) @db.UnsignedInt // 1: rm 1v1
  rating    Int      @db.UnsignedInt
  ranking   Int?     @db.UnsignedInt
  time      DateTime @db.DateTime(0)

  player player? @relation(fields: [voobly_id], references: [voobly_id])

  @@index([voobly_id], map: "voobly_id")
}

model extern_voobly_player_cache {
  id        Int      @id @default(autoincrement()) @db.UnsignedInt
  voobly_id Int      @db.UnsignedInt
  rm_1v1    Int      @db.UnsignedInt
  rm_tg     Int      @db.UnsignedInt
  time      DateTime @db.DateTime(0)

  player player? @relation(fields: [voobly_id], references: [voobly_id])

  @@index([voobly_id], map: "voobly_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model match_1v1 {
  id            Int       @id @default(autoincrement()) @db.UnsignedInt
  date          DateTime? @db.Date // when this match was played (null=auto from tournament)
  tournament_id Int?      @db.UnsignedInt
  stage_id      Int       @default(1) @db.UnsignedInt
  player_1_id   Int       @db.UnsignedInt
  player_2_id   Int       @db.UnsignedInt
  score_1       Int       @db.UnsignedInt
  score_2       Int       @db.UnsignedInt
  create_user   Int       @db.UnsignedInt
  create_time   DateTime  @db.DateTime(0)
  update_user   Int       @db.UnsignedInt
  update_time   DateTime  @db.DateTime(0)

  tournament    tournament?     @relation(fields: [tournament_id], references: [id])
  stage         stage           @relation(fields: [stage_id], references: [id])
  player_1      player          @relation("p1", fields: [player_1_id], references: [id])
  player_2      player          @relation("p2", fields: [player_2_id], references: [id])
  created_by    user?           @relation("create", fields: [create_user], references: [id])
  updated_by    user?           @relation("update", fields: [update_user], references: [id])
  elo_1v1_cache elo_1v1_cache[]
  player_cache  player_cache[]

  @@index([create_user], map: "created_user")
  @@index([date, tournament_id, player_1_id, player_2_id], map: "date")
  @@index([stage_id], map: "stage_id")
  @@index([update_user], map: "update_user")
}

model match_1v1_event {
  id            Int       @id @default(autoincrement()) @db.UnsignedInt
  date          DateTime? @db.Date
  time          DateTime? @db.Time(0)
  tournament_id Int       @db.UnsignedInt
  stage_id      Int       @db.UnsignedInt
  player_1_id   Int?      @db.UnsignedInt
  player_2_id   Int?      @db.UnsignedInt
  bo            Int?      @db.UnsignedInt
  create_user   Int       @db.UnsignedInt
  create_time   DateTime  @db.DateTime(0)
  update_user   Int       @db.UnsignedInt
  update_time   DateTime  @db.DateTime(0)

  @@index([create_user], map: "create_user")
  @@index([stage_id], map: "stage_id")
  @@index([player_1_id, player_2_id], map: "tournament_id")
  @@index([tournament_id], map: "tournament_id_2")
  @@index([update_user], map: "update_user")
  @@ignore
}

model meta_cache {
  id          Int    @id @default(autoincrement()) @db.UnsignedInt
  name        Int    @unique(map: "name")
  value_int   Int
  value_float Float
  value_str   String @db.Text
}

model page_ip_info {
  id           Int      @id @default(autoincrement()) @db.UnsignedInt
  time         DateTime @db.DateTime(0)
  ip           BigInt?
  data         String?  @db.Text
  longitude    Float?
  latitude     Float?
  country      String?  @db.VarChar(100)
  country_code String?  @db.VarChar(10)
  city         String?  @db.Text
  error        String?  @db.Text

  country_info country? @relation(fields: [country_code], references: [iso_key])
}

model page_visit {
  id          Int      @id @default(autoincrement()) @db.UnsignedInt
  time        DateTime @db.DateTime(0)
  session_key String?  @db.VarChar(255)
  hash        String?  @db.VarChar(100)
  user        Int?     @db.UnsignedInt
  ip          BigInt?
  ip_info     Int?     @db.UnsignedInt
  domain      String?  @db.VarChar(100)
  path        String?  @db.Text
  page        String?  @db.VarChar(255)
  entity_id   Int?     @db.UnsignedInt

  user_info user? @relation(fields: [user], references: [id])

  @@index([ip_info], map: "ip_info")
  @@index([page, entity_id], map: "page")
  @@index([session_key], map: "session_key")
  @@index([user], map: "user")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model player {
  id                         Int                          @id @default(autoincrement()) @db.UnsignedInt
  name                       String                       @unique(map: "name") @db.VarChar(100)
  alias                      String                       @db.VarChar(255) // comma-separated
  team_id                    Int?                         @db.UnsignedInt
  country_key                String?                      @db.VarChar(10)
  initial_elo_1v1            Int?                         @db.UnsignedInt
  voobly_id                  Int?                         @unique @db.UnsignedInt
  steam_id                   String?                      @db.VarChar(40)
  steam_id_failed            String?                      @unique @db.VarChar(40)
  twitch                     String?                      @db.Text
  youtube                    String?                      @db.Text
  twitter                    String?                      @db.Text
  facebook                   String?                      @db.Text
  create_user                Int                          @db.UnsignedInt
  create_time                DateTime                     @db.DateTime(0)
  update_user                Int                          @db.UnsignedInt
  update_time                DateTime                     @db.DateTime(0)
  extern_voobly_player_cache extern_voobly_player_cache[]
  extern_voobly_cache        extern_voobly_cache[]
  p1_1v1_matches             match_1v1[]                  @relation("p1")
  p2_1v1_matches             match_1v1[]                  @relation("p2")
  extern_de_cache            extern_de_cache[]
  elo_1v1_cache              elo_1v1_cache[]
  team                       team?                        @relation(fields: [team_id], references: [id])
  country                    country?                     @relation(fields: [country_key], references: [iso_key])
  created_by                 user?                        @relation("create", fields: [create_user], references: [id])
  updated_by                 user?                        @relation("update", fields: [update_user], references: [id])
  player_cache               player_cache?
  tournament_result          tournament_result[]

  @@index([create_user], map: "create_user")
  @@index([team_id], map: "team_id")
  @@index([update_user], map: "update_user")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model player_bak {
  id              Int      @id @default(autoincrement()) @db.UnsignedInt
  name            String   @unique(map: "name") @db.VarChar(30)
  alias           String   @db.VarChar(255) // comma-separated
  team_id         Int?     @db.UnsignedInt
  country_key     String?  @db.VarChar(10)
  initial_elo_1v1 Int?     @db.UnsignedInt
  voobly_id       Int?     @db.UnsignedInt
  steam_id        String?  @db.VarChar(40)
  steam_id_failed String?  @db.VarChar(40)
  twitch          String?  @db.Text
  youtube         String?  @db.Text
  twitter         String?  @db.Text
  facebook        String?  @db.Text
  create_user     Int      @db.UnsignedInt
  create_time     DateTime @db.DateTime(0)
  update_user     Int      @db.UnsignedInt
  update_time     DateTime @db.DateTime(0)

  @@index([create_user], map: "create_user")
  @@index([team_id], map: "team_id")
  @@index([update_user], map: "update_user")
  @@ignore
}

model player_cache {
  id              Int       @id @default(autoincrement()) @db.UnsignedInt
  player_id       Int       @unique(map: "player_id") @db.UnsignedInt
  num_matches     Int?      @db.UnsignedInt
  num_wins        Int?      @db.UnsignedInt
  num_games       Int?      @db.UnsignedInt
  tournament_ids  String?   @db.Text
  last_match      Int?      @db.UnsignedInt
  last_match_time DateTime? @db.DateTime(0)
  rank            Int?      @db.UnsignedInt
  elo             Int?      @db.UnsignedInt
  elo_update      DateTime? @db.DateTime(0)
  elo_peak        Int?      @db.UnsignedInt
  de_elo          Int?      @db.UnsignedInt
  de_rank         Int?      @db.UnsignedInt
  de_update       DateTime? @db.DateTime(0)
  voobly_elo      Int?      @db.UnsignedInt
  voobly_rank     Int?      @db.UnsignedInt
  voobly_update   DateTime? @db.DateTime(0)

  player       player?    @relation(fields: [player_id], references: [id])
  latest_match match_1v1? @relation(fields: [last_match], references: [id])
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model player_info {
  id          Int      @db.UnsignedInt
  player      Int      @db.UnsignedInt
  type        String   @db.VarChar(255)
  value_int   Int?
  value_str   String?  @db.Text
  create_time DateTime @db.DateTime(0)
  create_user Int      @db.UnsignedInt

  @@ignore
}

model stage {
  id         Int         @id @default(autoincrement()) @db.UnsignedInt
  name       String      @db.Text
  bracket    Int         @default(1) @db.UnsignedInt
  index      Int         @default(1) @db.UnsignedInt
  weight     Float       @default(1) @db.Float
  importance Int         @default(1) @db.UnsignedInt
  match_1v1  match_1v1[]
}

model subscription {
  id      Int      @id @default(autoincrement()) @db.UnsignedInt
  created DateTime @db.DateTime(0)
  email   String   @db.Text
  session String   @db.Text
}

model team {
  id              Int       @id @default(autoincrement()) @db.UnsignedInt
  name            String    @unique(map: "name") @db.VarChar(100)
  tag             String    @db.VarChar(30)
  primary_color   String?   @db.VarChar(30)
  secondary_color String?   @db.VarChar(30)
  create_user     Int?      @db.UnsignedInt
  create_time     DateTime? @db.DateTime(0)
  update_user     Int?      @db.UnsignedInt
  update_time     DateTime? @db.DateTime(0)
  player          player[]
  created_by      user?     @relation("create", fields: [create_user], references: [id])
  updated_by      user?     @relation("update", fields: [update_user], references: [id])

  @@index([create_user], map: "create_user")
  @@index([update_user], map: "update_user")
}

model ticket {
  id      Int      @id @default(autoincrement()) @db.UnsignedInt
  created DateTime @db.DateTime(0)
  user    Int?     @db.UnsignedInt
  type    String   @db.VarChar(255)
  done    Int      @default(0)
  message String   @db.Text
  contact String   @db.Text
  hash    String   @db.Text
  session String   @db.Text

  user_info user? @relation(fields: [user], references: [id])

  @@index([user], map: "user")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tournament {
  id                  Int                   @id @default(autoincrement()) @db.UnsignedInt
  name                String                @db.VarChar(255)
  short               String                @db.VarChar(100)
  start               DateTime?             @db.Date
  end                 DateTime?             @db.Date
  weight              Int                   @default(1) @db.UnsignedInt
  type                tournament_type       @default(cup)
  prizemoney          Int?                  @db.UnsignedInt // $
  parent_id           Int?                  @db.UnsignedInt
  structure           tournament_structure
  evaluation          String?               @db.VarChar(30)
  website             String?               @db.Text
  comment             String?               @db.Text
  create_user         Int                   @db.UnsignedInt
  create_time         DateTime              @db.DateTime(0)
  update_user         Int                   @db.UnsignedInt
  update_time         DateTime              @db.DateTime(0)
  elo_1v1_cache       elo_1v1_cache[]
  match_1v1           match_1v1[]
  tournament_info_bak tournament_info_bak[]
  tournament_info     tournament_info[]
  tournament_result   tournament_result[]
  created_by          user?                 @relation("create", fields: [create_user], references: [id])
  updated_by          user?                 @relation("update", fields: [update_user], references: [id])
  parent              tournament?           @relation("family", fields: [parent_id], references: [id])
  children            tournament[]          @relation("family")

  @@index([create_user], map: "create_user")
  @@index([parent_id], map: "parent_id")
  @@index([update_user], map: "update_user")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tournament_info {
  id            Int      @id @default(autoincrement()) @db.UnsignedInt
  create_user   Int      @db.UnsignedInt
  create_time   DateTime @db.DateTime(0)
  tournament_id Int      @db.UnsignedInt
  type          Int      @db.UnsignedInt // 1: challonge bracket, 2: bracket URL, 3: public res., 4: private res.
  description   String   @db.Text
  value         String   @db.Text

  tournament tournament? @relation(fields: [tournament_id], references: [id])
  created_by user?       @relation("create", fields: [create_user], references: [id])

  @@index([create_user], map: "create_user")
  @@index([type], map: "type")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tournament_info_bak {
  id            Int      @id @default(autoincrement()) @db.UnsignedInt
  create_user   Int      @db.UnsignedInt
  create_time   DateTime @db.DateTime(0)
  tournament_id Int      @db.UnsignedInt
  type          Int      @db.UnsignedInt // 1: challonge bracket, 2: bracket URL, 3: public res., 4: private res.
  description   String   @db.Text
  value         String   @db.Text

  tournament tournament? @relation(fields: [tournament_id], references: [id])
  created_by user?       @relation("create", fields: [create_user], references: [id])

  @@index([create_user], map: "create_user")
  @@index([type], map: "type")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tournament_result {
  id          Int      @id @default(autoincrement()) @db.UnsignedInt
  tournament  Int      @db.UnsignedInt
  player      Int      @db.UnsignedInt
  type        Int?     @db.UnsignedInt // 1: win, ..., 5: semi-finals, null: other
  money       Int?     @db.UnsignedInt
  source      String?  @db.Text
  create_time DateTime @db.DateTime(0)
  create_user Int      @db.UnsignedInt

  tournament_played tournament? @relation(fields: [tournament], references: [id])
  created_by        user?       @relation("create", fields: [create_user], references: [id])
  player_result     player?     @relation(fields: [player], references: [id])

  @@index([create_user], map: "create_user")
  @@index([player], map: "player")
  @@index([tournament], map: "tournament")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user {
  id                          Int                   @id @default(autoincrement()) @db.UnsignedInt
  name                        String                @db.VarChar(100)
  pass                        String                @db.VarChar(255)
  rank                        Int                   @default(1) @db.UnsignedInt // 1: admin, 2: normal
  allow_tournament            Int?                  @default(0) @db.UnsignedInt // 0: nothing, 1: create, 2: and update, 3: and remove
  allow_player                Int?                  @default(0) @db.UnsignedInt // 0: nothing, 1: create, 2: and update, 3: and remove
  allow_match                 Int?                  @default(0) // 0: nothing, 1: create, 2: and update, 3: and remove
  allow_see                   Int?                  @default(0) @db.UnsignedInt // 0: nothing, 1: create, 2: and update, 3: and remove
  created_1v1_matches         match_1v1[]           @relation("create")
  updated_1v1_matches         match_1v1[]           @relation("update")
  visited_pages               page_visit[]
  created_players             player[]              @relation("create")
  updated_players             player[]              @relation("update")
  created_tournament_info_bak tournament_info_bak[] @relation("create")
  created_tournament_results  tournament_result[]   @relation("create")
  created_tournament_info     tournament_info[]     @relation("create")
  created_tournaments         tournament[]          @relation("create")
  updated_tournaments         tournament[]          @relation("update")
  created_teams               team[]                @relation("create")
  updated_teams               team[]                @relation("update")
  ticket                      ticket[]
}

enum tournament_type {
  cup
  qualifier
}

enum tournament_structure {
  single_elemination @map("single-elemination")
  double_elimination @map("double-elimination")
  league
  other
  group
  group_ko           @map("group-ko")
}
